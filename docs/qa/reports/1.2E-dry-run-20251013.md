# 1.2E Dry-Run 리포트 — user_profiles 마이그레이션

Date: 2025-10-13
Mode: DRY-RUN (데이터베이스 명령 실제 실행 없음)
Scope: auth.users ↔ public.user_profiles, public.user_settings 전수 검증

## 사용 스크립트
- docs/scripts/check-user-profiles.sql
- docs/scripts/migrate-user-profiles.sql
- docs/scripts/create-single-user-profile.sql
- docs/scripts/bulk-migrate-users.sql

## 가정 및 근거
- 스키마 기준: supabase/migrations/20250925_create_auth_tables.sql, 20250929_*
- 트리거: public.handle_new_user() 기본형 존재 (예외 경로 보강은 별도)
- 중복 방지: ON CONFLICT (id) DO NOTHING 패턴 적용 예정

## 예상 결과 요약 (DRY-RUN)
- 누락 레코드 수(missing_count): 0
- 생성 예정(created_count): 0
- 스킵 예정(skipped_count): 기존 레코드 수만큼
- 오류(errors_count): 0

설명: Story 1.2C에서 발견된 누락은 수동 보정 완료(테스트 사용자). 이후 스크립트 골격 추가 상태에서 전수 검증 시 신규 누락이 없다는 전제.

## 실행 로그(샘플, 파일/테이블 공용 포맷)

```
run_id: "2025-10-13T09:00:00Z-1.2E-dry-run"
scope: "user_profiles-full-scan"
mode: "dry-run"
started_at: "2025-10-13T09:00:00Z"
finished_at: "2025-10-13T09:00:05Z"
status: "OK"
created_count: 0
skipped_count: <existing_profiles>
missing_count: 0
errors_count: 0
notes: ["no-op; validation only"]
```

## 트리거 예외 테스트(설계)
- OAuth/소셜/이메일 가입 경로별 신규 사용자 생성 시 user_profiles/user_settings 자동 생성 확인
- 예외 발생 시 보정 큐 또는 보정 스크립트 단일 실행(create-single-user-profile.sql)로 복구 가능성 확인

## 다음 단계
- 실행 모드(real-run)에서 동일 포맷으로 로그 적재
- 실행 로그 테이블(아래 스냅샷) 생성 후 INSERT 경로 연결
- 트리거 단위/통합 테스트 작성 및 녹색 확인


# Story 2.1 Appendix — 3D 컨피규레이터 기반 구조 세부

본 문서는 구현 세부/가이드/테스트 예시/이력 등을 모은 부록입니다. 핵심 요약은 `2.1.core.md`를 참조하세요.

## 구현 가이드(발췌)

### Three.js
- WebGL 컨텍스트: WebGL2 우선, WebGL1 폴백 처리
- 렌더러: `antialias: true`, `alpha: true`, 모바일 pixelRatio 상한 2
- 카메라: Perspective(FOV 75), 초기 위치 (5,5,5)
- 컨트롤: OrbitControls(`enableDamping: true`, `dampingFactor: 0.05`)
- 조명: Directional(0.8), Ambient(0.4), 그림자 활성화

### 재료 시스템
- 옵션: 원목(#D2691E), MDF(#F5DEB3), 스틸(#708090)
- 재질: Wood=Phong, MDF=Lambert, Steel=Standard(metalness/roughness)
- 변경 시 머터리얼 교체 및 씬 업데이트

### 치수 조절
- 범위: 가로 80~200, 세로 40~80, 높이 70~85(단위 cm)
- 1cm 단위 입력/슬라이더, 스케일 반영 및 애니메이션 적용

### BFF 연동
- 엔드포인트: `/api/v1/bff/configurator`
- GET: 재료/기본설정, POST: 구성 상태 저장(임시)

## 성능/호환성 요구
- 모바일 FPS ≥ 30, 초기 로딩 ≤ 3s, 메모리 ≤ 100MB
- 브라우저: Chrome/Safari/Firefox/Edge 최신 2버전
- WebGL2 권장, WebGL1 폴백

## 테스트 전략/예시
- jsdom Unit/Component: 씬 초기화, 재료/치수 변경, 콜백 호출
- Playwright E2E: 캔버스 크기/렌더/OrbitControls/FPS 표기/폴백
- 예시 파일: `__tests__/components/three/ThreeCanvas.test.tsx`, `__tests__/e2e/configurator/ThreeCanvas.e2e.test.tsx`

```ts
// 예시(발췌): 재료 변경 시 색상 반영
fireEvent.click(getByTestId('material-wood'))
expect(deskMesh.material.color.getHex()).toBe(0xD2691E)
```

## NFR 메모 (2025-10-13)
- jsdom 폴리필 보완: `jest.polyfills.js`에 matchMedia/RAF/canvas.getContext 모킹 추가
- 실측 로그 대기: FPS/초기화시간/콘솔 무에러 근거 확보되면 Gate 상향 검토

## Dev Agent Record (요약)
- 주요 파일: `src/lib/three/*`, `src/components/three/*`, `src/app/configurator/*`
- 성능 모니터: FPS/프레임타임 콜백 상위 전달
- 테스트 커버리지: 3D 유틸 상위, 컴포넌트/인터랙션 핵심 시나리오 포함

## 변경 이력(요약)
- 2025-10-13: 문서 샤딩(Core/Appendix), jsdom 폴리필 보완 반영
- 2025-10-10: Re-Review, 성능 스냅샷 테스트 추가

## 링크
- Core: `docs/stories/2.1/2.1.core.md`
- Gate: `docs/qa/gates/2.1-3d-configurator-foundation.yml`
